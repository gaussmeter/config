<div class="container" id="data">
    Data -- These are not the droids you are looking for.
</div>
<!--<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.css" />-->
<script>
    $( document ).ready(function() {
        var data = [];
        $.getJSON("/streamr/2019", function(stream) {
           //console.log(stream);
           //console.log(stream['fial']);
            $.each(stream['kv'], function (i, item) {
                //console.log(atob(item['key']) + atob(item['value']));
                state = $.parseJSON(atob(item['value']))
                //console.log(state['data_state']['isGood'])
                if (state['data_state']['isGood'] == true) {
                    //data.push([Date.parse(atob(item['key'])+'Z'),state['charge_state']['battery_range']])
                    data.push([i,state['charge_state']['battery_range']])
                    g.updateOptions( { 'file': data } );
                }
            })
        })
        var g = new Dygraph(document.getElementById("data"), data,
            {
                drawPoints: true,
                showRoller: true,
                //valueRange: [0.0, 1.2],
                labels: ['Time', 'Range']
            });
        // It sucks that these things aren't objects, and we need to store state in window.
        ///window.intervalId = setInterval(function() {
            //var x = new Date();  // current time
            //var y = Math.random();
            //data.push([x, y]);
            ///g.updateOptions( { 'file': data } );
        ///}, 1000);
    });

</script>