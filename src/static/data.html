<div class="container" id="data">
    Data -- These are not the droids you are looking for.
</div>
<script>
    $( document ).ready(function() {
        var data = [];
        $.getJSON("/streamr/2019", function(stream) {
           //console.log(stream);
           //console.log(stream['fial']);
            $.each(stream['kv'], function (i, item) {
                //console.log(atob(item['key']) + atob(item['value']));
                state = $.parseJSON(atob(item['value']))
                //console.log(state['data_state']['isGood'])
                if (state['data_state']['isGood'] == true) {
                    //data.push([Date.parse(atob(item['key'])+'Z'),state['charge_state']['battery_range']])
                    datetime = new Date(atob(item['key']))
                    //console.log(parseInt(state['vehicle_state']['distanceFromHome'])/5280)
                    data.push([datetime,state['charge_state']['battery_range'],state['charge_state']['charge_rate'], state['charge_state']['battery_level'],parseInt(state['vehicle_state']['distanceFromHome'])/5280])
                    g.updateOptions( { 'file': data } );
                }
            })
        })
        var g = new Dygraph(document.getElementById("data"), data,
            {
                drawPoints: true,
                showRoller: true,
                //valueRange: [0.0, 1.2],
                //labels: ['Time', 'Range', 'Rate', ['Percent']]
                labels: ['Time', 'Range', 'Rate', 'Percent', 'Distance From Home']
            });
        // It sucks that these things aren't objects, and we need to store state in window.
        ///window.intervalId = setInterval(function() {
            //var x = new Date();  // current time
            //var y = Math.random();
            //data.push([x, y]);
            ///g.updateOptions( { 'file': data } );
        ///}, 1000);
    });

</script>